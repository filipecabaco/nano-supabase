var me=Object.defineProperty;var he=(n,e)=>()=>(n&&(e=n(n=0)),e);var ve=(n,e)=>{for(var t in e)me(n,t,{get:e[t],enumerable:!0})};var K={};ve(K,{NodeSocket:()=>D,connect:()=>$e,listen:()=>je});import{createServer as Oe}from"node:net";async function $e(n,e){let{createConnection:t}=await import("node:net"),r=t({host:n.hostname,port:n.port});return new D(r)}async function je(n){let e=Oe(t=>{let r=new D(t);n.handler.onConnection(r)});return e.on("error",t=>{n.handler.onError?.(t)}),new Promise(t=>{e.listen(n.port,n.hostname??"0.0.0.0",()=>{t()})})}var D,Z=he(()=>{"use strict";D=class{readable;writable;opened;closed;socket;openedResolve;openedReject;closedResolve;constructor(e){this.socket=e,this.opened=new Promise((r,i)=>{this.openedResolve=r,this.openedReject=i}),this.closed=new Promise(r=>{this.closedResolve=r}),this.readable=new ReadableStream({start:r=>{e.on("data",i=>{r.enqueue(new Uint8Array(i))}),e.on("end",()=>{r.close()}),e.on("error",i=>{r.error(i),this.openedReject(i)})},cancel:()=>{e.destroy()}}),this.writable=new WritableStream({write:r=>new Promise((i,s)=>{e.write(r,c=>{c?s(c):i()})||e.once("drain",i)}),close:()=>new Promise(r=>{e.end(()=>r())}),abort:r=>{e.destroy(r instanceof Error?r:new Error(String(r)))}});let t=()=>{let r=e.address(),i=e.remoteAddress,s=e.remotePort;typeof r=="object"&&r&&"address"in r&&"port"in r&&i&&typeof s=="number"&&this.openedResolve({localAddress:{hostname:r.address,port:r.port},remoteAddress:{hostname:i,port:s}})};e.remoteAddress&&e.remotePort?setImmediate(t):e.on("connect",t),e.on("close",()=>{this.closedResolve()})}async close(){return this.socket.destroy(),this.closed}}});var k=class n{static __wrap(e){e=e>>>0;let t=Object.create(n.prototype);return t.__wbg_ptr=e,ne.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,ne.unregister(this),e}free(){let e=this.__destroy_into_raw();o.__wbg_wasmqueryresult_free(e,0)}get params(){let e=o.wasmqueryresult_params(this.__wbg_ptr);return b(e)}get query(){let e,t;try{let s=o.__wbindgen_add_to_stack_pointer(-16);o.wasmqueryresult_query(s,this.__wbg_ptr);var r=_().getInt32(s+4*0,!0),i=_().getInt32(s+4*1,!0);return e=r,t=i,I(r,i)}finally{o.__wbindgen_add_to_stack_pointer(16),o.__wbindgen_export4(e,t,1)}}get tables(){let e=o.wasmqueryresult_tables(this.__wbg_ptr);return b(e)}toJSON(){let e=o.wasmqueryresult_toJSON(this.__wbg_ptr);return b(e)}};Symbol.dispose&&(k.prototype[Symbol.dispose]=k.prototype.free);function oe(n){try{let i=o.__wbindgen_add_to_stack_pointer(-16);o.buildFilterClause(i,l(n));var e=_().getInt32(i+4*0,!0),t=_().getInt32(i+4*1,!0),r=_().getInt32(i+4*2,!0);if(r)throw b(t);return b(e)}finally{o.__wbindgen_add_to_stack_pointer(16)}}function G(n){let e=o.initSchemaFromDb(l(n));return b(e)}function se(n,e,t){try{let d=o.__wbindgen_add_to_stack_pointer(-16),w=p(n,o.__wbindgen_export,o.__wbindgen_export2),y=f,h=p(e,o.__wbindgen_export,o.__wbindgen_export2),m=f;var r=g(t)?0:p(t,o.__wbindgen_export,o.__wbindgen_export2),i=f;o.parseDelete(d,w,y,h,m,r,i);var s=_().getInt32(d+4*0,!0),a=_().getInt32(d+4*1,!0),c=_().getInt32(d+4*2,!0);if(c)throw b(a);return k.__wrap(s)}finally{o.__wbindgen_add_to_stack_pointer(16)}}function ue(n,e,t,r){try{let h=o.__wbindgen_add_to_stack_pointer(-16),m=p(n,o.__wbindgen_export,o.__wbindgen_export2),x=f,P=p(e,o.__wbindgen_export,o.__wbindgen_export2),T=f;var i=g(t)?0:p(t,o.__wbindgen_export,o.__wbindgen_export2),s=f,a=g(r)?0:p(r,o.__wbindgen_export,o.__wbindgen_export2),c=f;o.parseInsert(h,m,x,P,T,i,s,a,c);var d=_().getInt32(h+4*0,!0),w=_().getInt32(h+4*1,!0),y=_().getInt32(h+4*2,!0);if(y)throw b(w);return k.__wrap(d)}finally{o.__wbindgen_add_to_stack_pointer(16)}}function ae(n){try{let i=o.__wbindgen_add_to_stack_pointer(-16),s=p(n,o.__wbindgen_export,o.__wbindgen_export2),a=f;o.parseOnly(i,s,a);var e=_().getInt32(i+4*0,!0),t=_().getInt32(i+4*1,!0),r=_().getInt32(i+4*2,!0);if(r)throw b(t);return b(e)}finally{o.__wbindgen_add_to_stack_pointer(16)}}function F(n,e,t,r,i){try{let m=o.__wbindgen_add_to_stack_pointer(-16),x=p(n,o.__wbindgen_export,o.__wbindgen_export2),P=f,T=p(e,o.__wbindgen_export,o.__wbindgen_export2),be=f,we=p(t,o.__wbindgen_export,o.__wbindgen_export2),ye=f;var s=g(r)?0:p(r,o.__wbindgen_export,o.__wbindgen_export2),a=f,c=g(i)?0:p(i,o.__wbindgen_export,o.__wbindgen_export2),d=f;o.parseRequest(m,x,P,T,be,we,ye,s,a,c,d);var w=_().getInt32(m+4*0,!0),y=_().getInt32(m+4*1,!0),h=_().getInt32(m+4*2,!0);if(h)throw b(y);return k.__wrap(w)}finally{o.__wbindgen_add_to_stack_pointer(16)}}function ce(n,e,t,r){try{let x=o.__wbindgen_add_to_stack_pointer(-16),P=p(n,o.__wbindgen_export,o.__wbindgen_export2),T=f;var i=g(e)?0:p(e,o.__wbindgen_export,o.__wbindgen_export2),s=f,a=g(t)?0:p(t,o.__wbindgen_export,o.__wbindgen_export2),c=f,d=g(r)?0:p(r,o.__wbindgen_export,o.__wbindgen_export2),w=f;o.parseRpc(x,P,T,i,s,a,c,d,w);var y=_().getInt32(x+4*0,!0),h=_().getInt32(x+4*1,!0),m=_().getInt32(x+4*2,!0);if(m)throw b(h);return k.__wrap(y)}finally{o.__wbindgen_add_to_stack_pointer(16)}}function le(n,e,t,r){try{let w=o.__wbindgen_add_to_stack_pointer(-16),y=p(n,o.__wbindgen_export,o.__wbindgen_export2),h=f,m=p(e,o.__wbindgen_export,o.__wbindgen_export2),x=f,P=p(t,o.__wbindgen_export,o.__wbindgen_export2),T=f;var i=g(r)?0:p(r,o.__wbindgen_export,o.__wbindgen_export2),s=f;o.parseUpdate(w,y,h,m,x,P,T,i,s);var a=_().getInt32(w+4*0,!0),c=_().getInt32(w+4*1,!0),d=_().getInt32(w+4*2,!0);if(d)throw b(c);return k.__wrap(a)}finally{o.__wbindgen_add_to_stack_pointer(16)}}function xe(){return{__proto__:null,"./postgrest_parser_bg.js":{__proto__:null,__wbg_Error_8c4e43fe74559d73:function(e,t){let r=Error(I(e,t));return l(r)},__wbg_Number_04624de7d0e8332d:function(e){return Number(u(e))},__wbg_String_8f0eb39a4a4c2f66:function(e,t){let r=String(u(t)),i=p(r,o.__wbindgen_export,o.__wbindgen_export2),s=f;_().setInt32(e+4,s,!0),_().setInt32(e+0,i,!0)},__wbg___wbindgen_bigint_get_as_i64_8fcf4ce7f1ca72a2:function(e,t){let r=u(t),i=typeof r=="bigint"?r:void 0;_().setBigInt64(e+8,g(i)?BigInt(0):i,!0),_().setInt32(e+0,!g(i),!0)},__wbg___wbindgen_boolean_get_bbbb1c18aa2f5e25:function(e){let t=u(e),r=typeof t=="boolean"?t:void 0;return g(r)?16777215:r?1:0},__wbg___wbindgen_debug_string_0bc8482c6e3508ae:function(e,t){let r=z(u(t)),i=p(r,o.__wbindgen_export,o.__wbindgen_export2),s=f;_().setInt32(e+4,s,!0),_().setInt32(e+0,i,!0)},__wbg___wbindgen_in_47fa6863be6f2f25:function(e,t){return u(e)in u(t)},__wbg___wbindgen_is_bigint_31b12575b56f32fc:function(e){return typeof u(e)=="bigint"},__wbg___wbindgen_is_function_0095a73b8b156f76:function(e){return typeof u(e)=="function"},__wbg___wbindgen_is_object_5ae8e5880f2c1fbd:function(e){let t=u(e);return typeof t=="object"&&t!==null},__wbg___wbindgen_is_string_cd444516edc5b180:function(e){return typeof u(e)=="string"},__wbg___wbindgen_is_undefined_9e4d92534c42d778:function(e){return u(e)===void 0},__wbg___wbindgen_jsval_eq_11888390b0186270:function(e,t){return u(e)===u(t)},__wbg___wbindgen_jsval_loose_eq_9dd77d8cd6671811:function(e,t){return u(e)==u(t)},__wbg___wbindgen_number_get_8ff4255516ccad3e:function(e,t){let r=u(t),i=typeof r=="number"?r:void 0;_().setFloat64(e+8,g(i)?0:i,!0),_().setInt32(e+0,!g(i),!0)},__wbg___wbindgen_string_get_72fb696202c56729:function(e,t){let r=u(t),i=typeof r=="string"?r:void 0;var s=g(i)?0:p(i,o.__wbindgen_export,o.__wbindgen_export2),a=f;_().setInt32(e+4,a,!0),_().setInt32(e+0,s,!0)},__wbg___wbindgen_throw_be289d5034ed271b:function(e,t){throw new Error(I(e,t))},__wbg__wbg_cb_unref_d9b87ff7982e3b21:function(e){u(e)._wbg_cb_unref()},__wbg_call_389efe28435a9388:function(){return U(function(e,t){let r=u(e).call(u(t));return l(r)},arguments)},__wbg_call_4708e0c13bdc8e95:function(){return U(function(e,t,r){let i=u(e).call(u(t),u(r));return l(i)},arguments)},__wbg_done_57b39ecd9addfe81:function(e){return u(e).done},__wbg_entries_58c7934c745daac7:function(e){let t=Object.entries(u(e));return l(t)},__wbg_error_7534b8e9a36f1ab4:function(e,t){let r,i;try{r=e,i=t,console.error(I(e,t))}finally{o.__wbindgen_export4(r,i,1)}},__wbg_get_9b94d73e6221f75c:function(e,t){let r=u(e)[t>>>0];return l(r)},__wbg_get_b3ed3ad4be2bc8ac:function(){return U(function(e,t){let r=Reflect.get(u(e),u(t));return l(r)},arguments)},__wbg_get_with_ref_key_1dc361bd10053bfe:function(e,t){let r=u(e)[u(t)];return l(r)},__wbg_instanceof_ArrayBuffer_c367199e2fa2aa04:function(e){let t;try{t=u(e)instanceof ArrayBuffer}catch{t=!1}return t},__wbg_instanceof_Map_53af74335dec57f4:function(e){let t;try{t=u(e)instanceof Map}catch{t=!1}return t},__wbg_instanceof_Uint8Array_9b9075935c74707c:function(e){let t;try{t=u(e)instanceof Uint8Array}catch{t=!1}return t},__wbg_isArray_d314bb98fcf08331:function(e){return Array.isArray(u(e))},__wbg_isSafeInteger_bfbc7332a9768d2a:function(e){return Number.isSafeInteger(u(e))},__wbg_iterator_6ff6560ca1568e55:function(){return l(Symbol.iterator)},__wbg_length_32ed9a279acd054c:function(e){return u(e).length},__wbg_length_35a7bace40f36eac:function(e){return u(e).length},__wbg_log_6b5ca2e6124b2808:function(e){console.log(u(e))},__wbg_new_361308b2356cecd0:function(){let e=new Object;return l(e)},__wbg_new_3eb36ae241fe6f44:function(){let e=new Array;return l(e)},__wbg_new_8a6f238a6ece86ea:function(){let e=new Error;return l(e)},__wbg_new_b5d9e2fb389fef91:function(e,t){try{var r={a:e,b:t},i=(a,c)=>{let d=r.a;r.a=0;try{return ke(d,r.b,a,c)}finally{r.a=d}};let s=new Promise(i);return l(s)}finally{r.a=r.b=0}},__wbg_new_dca287b076112a51:function(){return l(new Map)},__wbg_new_dd2b680c8bf6ae29:function(e){let t=new Uint8Array(u(e));return l(t)},__wbg_new_no_args_1c7c842f08d00ebb:function(e,t){let r=new Function(I(e,t));return l(r)},__wbg_next_3482f54c49e8af19:function(){return U(function(e){let t=u(e).next();return l(t)},arguments)},__wbg_next_418f80d8f5303233:function(e){let t=u(e).next;return l(t)},__wbg_prototypesetcall_bdcdcc5842e4d77d:function(e,t,r){Uint8Array.prototype.set.call(Te(e,t),u(r))},__wbg_queueMicrotask_0aa0a927f78f5d98:function(e){let t=u(e).queueMicrotask;return l(t)},__wbg_queueMicrotask_5bb536982f78a56f:function(e){queueMicrotask(u(e))},__wbg_resolve_002c4b7d9d8f6b64:function(e){let t=Promise.resolve(u(e));return l(t)},__wbg_set_1eb0999cf5d27fc8:function(e,t,r){let i=u(e).set(u(t),u(r));return l(i)},__wbg_set_3f1d0b984ed272ed:function(e,t,r){u(e)[b(t)]=b(r)},__wbg_set_f43e577aea94465b:function(e,t,r){u(e)[t>>>0]=b(r)},__wbg_stack_0ed75d68575b0f3c:function(e,t){let r=u(t).stack,i=p(r,o.__wbindgen_export,o.__wbindgen_export2),s=f;_().setInt32(e+4,s,!0),_().setInt32(e+0,i,!0)},__wbg_static_accessor_GLOBAL_12837167ad935116:function(){let e=typeof global>"u"?null:global;return g(e)?0:l(e)},__wbg_static_accessor_GLOBAL_THIS_e628e89ab3b1c95f:function(){let e=typeof globalThis>"u"?null:globalThis;return g(e)?0:l(e)},__wbg_static_accessor_SELF_a621d3dfbb60d0ce:function(){let e=typeof self>"u"?null:self;return g(e)?0:l(e)},__wbg_static_accessor_WINDOW_f8727f0cf888e0bd:function(){let e=typeof window>"u"?null:window;return g(e)?0:l(e)},__wbg_then_0d9fe2c7b1857d32:function(e,t,r){let i=u(e).then(u(t),u(r));return l(i)},__wbg_then_b9e7b3b5f1a9e1b5:function(e,t){let r=u(e).then(u(t));return l(r)},__wbg_value_0546255b415e96c1:function(e){let t=u(e).value;return l(t)},__wbindgen_cast_0000000000000001:function(e,t){let r=Qe(e,t,o.__wasm_bindgen_func_elem_366,Se);return l(r)},__wbindgen_cast_0000000000000002:function(e){return l(e)},__wbindgen_cast_0000000000000003:function(e){return l(e)},__wbindgen_cast_0000000000000004:function(e,t){let r=I(e,t);return l(r)},__wbindgen_cast_0000000000000005:function(e){let t=BigInt.asUintN(64,e);return l(t)},__wbindgen_object_clone_ref:function(e){let t=u(e);return l(t)},__wbindgen_object_drop_ref:function(e){b(e)}}}}function Se(n,e,t){o.__wasm_bindgen_func_elem_367(n,e,l(t))}function ke(n,e,t,r){o.__wasm_bindgen_func_elem_442(n,e,l(t),l(r))}var ne=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>o.__wbg_wasmqueryresult_free(n>>>0,1));function l(n){O===S.length&&S.push(S.length+1);let e=O;return O=S[e],S[e]=n,e}var ie=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>n.dtor(n.a,n.b));function z(n){let e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){let i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){let i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){let i=n.length,s="[";i>0&&(s+=z(n[0]));for(let a=1;a<i;a++)s+=", "+z(n[a]);return s+="]",s}let t=/\[object ([^\]]+)\]/.exec(toString.call(n)),r;if(t&&t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}function Pe(n){n<132||(S[n]=O,O=n)}function Te(n,e){return n=n>>>0,C().subarray(n/1,n/1+e)}var Q=null;function _(){return(Q===null||Q.buffer.detached===!0||Q.buffer.detached===void 0&&Q.buffer!==o.memory.buffer)&&(Q=new DataView(o.memory.buffer)),Q}function I(n,e){return n=n>>>0,qe(n,e)}var B=null;function C(){return(B===null||B.byteLength===0)&&(B=new Uint8Array(o.memory.buffer)),B}function u(n){return S[n]}function U(n,e){try{return n.apply(this,e)}catch(t){o.__wbindgen_export3(l(t))}}var S=new Array(128).fill(void 0);S.push(void 0,null,!0,!1);var O=S.length;function g(n){return n==null}function Qe(n,e,t,r){let i={a:n,b:e,cnt:1,dtor:t},s=(...a)=>{i.cnt++;let c=i.a;i.a=0;try{return r(c,i.b,...a)}finally{i.a=c,s._wbg_cb_unref()}};return s._wbg_cb_unref=()=>{--i.cnt===0&&(i.dtor(i.a,i.b),i.a=0,ie.unregister(i))},ie.register(s,i,i),s}function p(n,e,t){if(t===void 0){let c=$.encode(n),d=e(c.length,1)>>>0;return C().subarray(d,d+c.length).set(c),f=c.length,d}let r=n.length,i=e(r,1)>>>0,s=C(),a=0;for(;a<r;a++){let c=n.charCodeAt(a);if(c>127)break;s[i+a]=c}if(a!==r){a!==0&&(n=n.slice(a)),i=t(i,r,r=a+n.length*3,1)>>>0;let c=C().subarray(i+a,i+r),d=$.encodeInto(n,c);a+=d.written,i=t(i,r,a,1)>>>0}return f=a,i}function b(n){let e=u(n);return Pe(n),e}var M=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});M.decode();var Re=2146435072,L=0;function qe(n,e){return L+=e,L>=Re&&(M=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),M.decode(),L=e),M.decode(C().subarray(n,n+e))}var $=new TextEncoder;"encodeInto"in $||($.encodeInto=function(n,e){let t=$.encode(n);return e.set(t),{read:n.length,written:t.length}});var f=0,Ie,o;function Ae(n,e){return o=n.exports,Ie=e,Q=null,B=null,o.__wbindgen_start(),o}async function Ee(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(i){if(n.ok&&t(n.type)&&n.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}let r=await n.arrayBuffer();return await WebAssembly.instantiate(r,e)}else{let r=await WebAssembly.instantiate(n,e);return r instanceof WebAssembly.Instance?{instance:r,module:n}:r}function t(r){switch(r){case"basic":case"cors":case"default":return!0}return!1}}async function J(n){if(o!==void 0)return o;n!==void 0&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),n===void 0&&(n=new URL("postgrest_parser_bg.wasm",import.meta.url));let e=xe();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));let{instance:t,module:r}=await Ee(await n,e);return Ae(t,r)}function R(n){return{query:n.query,params:n.params,tables:n.tables}}function A(n){return n?JSON.stringify(n):void 0}function W(n){if(!n)return;let e=[];return n.return&&e.push(`return=${n.return}`),n.resolution&&e.push(`resolution=${n.resolution}`),n.missing&&e.push(`missing=${n.missing}`),n.count&&e.push(`count=${n.count}`),e.length>0?e.join(","):void 0}function E(n,e){let t=[];if(n)for(let[r,i]of Object.entries(n))t.push(`${r}=${i}`);if(e?.select){let r=Array.isArray(e.select)?e.select.join(","):e.select;t.push(`select=${r}`)}if(e?.order){let r=Array.isArray(e.order)?e.order.join(","):e.order;t.push(`order=${r}`)}if(e?.limit!==void 0&&t.push(`limit=${e.limit}`),e?.offset!==void 0&&t.push(`offset=${e.offset}`),e?.onConflict){let r=Array.isArray(e.onConflict)?e.onConflict.join(","):e.onConflict;t.push(`on_conflict=${r}`)}if(e?.returning){let r=Array.isArray(e.returning)?e.returning.join(","):e.returning;t.push(`returning=${r}`)}return t.join("&")}var H=class{parseRequest(e,t,r,i,s){let a=i?JSON.stringify(i):void 0,c=s?A(s):void 0,d=F(e,t,r,a,c);return R(d)}select(e,t={}){let r=E(t.filters,t),i=t.count?{Prefer:`count=${t.count}`}:void 0,s=F("GET",e,r,void 0,A(i));return R(s)}insert(e,t,r={}){let i=E(void 0,{onConflict:r.onConflict,returning:r.returning}),s=W(r.prefer),a=s?{Prefer:s}:void 0,c=ue(e,JSON.stringify(t),i||void 0,A(a));return R(c)}upsert(e,t,r,i={}){let s={};for(let y of r)y in t&&(s[y]=`eq.${t[y]}`);let a=E(s,{returning:i.returning}),c=W(i.prefer),d=c?{Prefer:c}:void 0,w=F("PUT",e,a,JSON.stringify(t),A(d));return R(w)}update(e,t,r,i={}){let s=E(r,{returning:i.returning}),a=W(i.prefer),c=a?{Prefer:a}:void 0,d=le(e,JSON.stringify(t),s,A(c));return R(d)}delete(e,t,r={}){let i=E(t,{returning:r.returning}),s=W(r.prefer),c=se(e,i,A(s?{Prefer:s}:void 0));return R(c)}rpc(e,t={},r={}){let i=E(r.filters,r),s=ce(e,JSON.stringify(t),i||void 0,void 0);return R(s)}parseOnly(e){return ae(e)}buildFilterClause(e){return oe(e)}};function _e(){return new H}var q=class n{client;static initPromise=null;constructor(){this.client=_e()}static async init(){n.initPromise||(n.initPromise=J()),await n.initPromise}static async initSchema(e){await n.init(),await G(e)}parseSelect(e,t=""){return this.parseRequest("GET",e,t)}parseInsert(e,t,r=""){return this.parseRequest("POST",e,r,t)}parseUpdate(e,t,r){return this.parseRequest("PATCH",e,r,t)}parseDelete(e,t){return this.parseRequest("DELETE",e,t)}parseRpc(e,t,r=""){let i=`rpc/${e}`;return this.parseRequest("POST",i,r,t)}parseRequest(e,t,r="",i){let s=this.client.parseRequest(e,t,r,i??null,null);return this.convertResult(s)}convertResult(e){return{sql:e.query,params:Array.isArray(e.params)?e.params:[],tables:Array.isArray(e.tables)?e.tables:[]}}};var N=class{db;parser;constructor(e,t){this.db=e,this.parser=t}from(e){return new V(this.db,this.parser,e)}async rpc(e,t){try{let r=this.parser.parseRpc(e,t);return{data:(await this.db.query(r.sql,[...r.params])).rows,error:null}}catch(r){return{data:null,error:r}}}},V=class{db;parser;table;selectColumns;filters=[];orderBy;limitCount;offsetCount;insertData;updateData;isDelete=!1;expectSingle=!1;expectMaybeSingle=!1;constructor(e,t,r){this.db=e,this.parser=t,this.table=r}select(e="*"){return this.selectColumns=e,this}insert(e){return this.insertData=e,this}update(e){return this.updateData=e,this}delete(){return this.isDelete=!0,this}eq(e,t){return this.filters.push(`${e}=eq.${String(t)}`),this}neq(e,t){return this.filters.push(`${e}=neq.${String(t)}`),this}gt(e,t){return this.filters.push(`${e}=gt.${String(t)}`),this}gte(e,t){return this.filters.push(`${e}=gte.${String(t)}`),this}lt(e,t){return this.filters.push(`${e}=lt.${String(t)}`),this}lte(e,t){return this.filters.push(`${e}=lte.${String(t)}`),this}like(e,t){return this.filters.push(`${e}=like.${t}`),this}ilike(e,t){return this.filters.push(`${e}=ilike.${t}`),this}in(e,t){let r=t.map(String).join(",");return this.filters.push(`${e}=in.(${r})`),this}is(e,t){let r=t===null?"null":t?"true":"false";return this.filters.push(`${e}=is.${r}`),this}order(e,t){let r=t?.ascending===!1?"desc":"asc",i=t?.nullsFirst?"nullsfirst":"nullslast";return this.orderBy=`${e}.${r}.${i}`,this}limit(e){return this.limitCount=e,this}range(e,t){return this.offsetCount=e,this.limitCount=t-e+1,this}single(){return this.expectSingle=!0,this.limitCount=1,this}maybeSingle(){return this.expectMaybeSingle=!0,this.limitCount=1,this}async then(e){let t=await this.execute();return e?e(t):t}async execute(){try{let e=this.buildQueryString(),t;if(this.insertData!==void 0){let s=Array.isArray(this.insertData)?this.insertData[0]??{}:this.insertData;t=this.parser.parseInsert(this.table,s,e)}else this.updateData!==void 0?t=this.parser.parseUpdate(this.table,this.updateData,e):this.isDelete?t=this.parser.parseDelete(this.table,e):t=this.parser.parseSelect(this.table,e);let r=await this.db.query(t.sql,[...t.params]);if(this.expectSingle&&r.rows.length===0)throw new Error("No rows returned");if(this.expectSingle&&r.rows.length>1)throw new Error("Multiple rows returned");return{data:this.expectSingle||this.expectMaybeSingle?r.rows[0]??null:r.rows,error:null}}catch(e){return{data:null,error:e}}}buildQueryString(){let e=[];return this.selectColumns&&e.push(`select=${this.selectColumns}`),e.push(...this.filters),this.orderBy&&e.push(`order=${this.orderBy}`),this.limitCount!==void 0&&e.push(`limit=${this.limitCount}`),this.offsetCount!==void 0&&e.push(`offset=${this.offsetCount}`),e.join("&")}};async function Be(n){await q.init(),await q.initSchema(async t=>({rows:(await n.query(t)).rows}));let e=new q;return new N(n,e)}import{randomUUID as Ce}from"node:crypto";var j=class{queues;maxSize;constructor(e=1e3){this.maxSize=e,this.queues=new Map([[0,[]],[1,[]],[2,[]],[3,[]]])}enqueue(e){let t=this.queues.get(e.priority);if(!t)throw new Error(`Invalid priority: ${e.priority}`);if(this.size()>=this.maxSize)throw new Error("Queue is full");t.push(e)}dequeue(){for(let e of[0,1,2,3]){let t=this.queues.get(e);if(t&&t.length>0)return t.shift()??null}return null}size(){return Array.from(this.queues.values()).reduce((e,t)=>e+t.length,0)}isEmpty(){return this.size()===0}clear(){for(let e of this.queues.values())e.length=0}};var X=class{db;queue;running=!1;config;constructor(e,t={}){this.db=e,this.queue=new j(t.maxQueueSize??1e3),this.config={maxQueueSize:t.maxQueueSize??1e3,defaultTimeout:t.defaultTimeout??5e3}}async start(){if(this.running)throw new Error("Pooler already started");this.running=!0,setImmediate(()=>{this.processQueue().catch(e=>{console.error("Queue processor error:",e),this.running=!1})}),await new Promise(e=>setImmediate(e))}async stop(){this.running=!1}async query(e,t,r=2){return new Promise((i,s)=>{let a={id:Ce(),sql:e,params:t,priority:r,enqueuedAt:Date.now(),resolve:i,reject:s,timeoutMs:this.config.defaultTimeout};try{this.queue.enqueue(a)}catch(c){s(c instanceof Error?c:new Error(String(c)))}})}async processQueue(){for(;this.running;){let e=this.queue.dequeue();if(!e){await new Promise(t=>setTimeout(t,10));continue}try{let t=await this.executeWithTimeout(e);e.resolve(t)}catch(t){e.reject(t instanceof Error?t:new Error(String(t)))}}}async executeWithTimeout(e){let t=e.timeoutMs??this.config.defaultTimeout,r=null,i=new Promise((a,c)=>{r=setTimeout(()=>{c(new Error("Query timeout"))},t)}),s=this.db.query(e.sql,e.params).finally(()=>{r&&clearTimeout(r)});return Promise.race([s,i])}};function Y(){return typeof Deno<"u"&&Deno?.version?.deno?"deno":typeof Bun<"u"&&Bun?.version?"bun":typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"?"workerd":typeof process<"u"&&process.versions?.node?"node":"unknown"}var v=Y(),de=v==="node",fe=v==="deno",pe=v==="bun",ge=v==="workerd";async function De(n,e){switch(v){case"node":{let{connect:t}=await Promise.resolve().then(()=>(Z(),K));return t(n,e)}case"deno":throw new Error("Deno adapter not yet implemented");case"bun":throw new Error("Bun adapter not yet implemented");case"workerd":throw new Error("Cloudflare Workers adapter not yet implemented");default:throw new Error(`Unsupported runtime: ${v}`)}}async function ee(n){switch(v){case"node":{let{listen:e}=await Promise.resolve().then(()=>(Z(),K));return e(n)}case"deno":throw new Error("Deno adapter not yet implemented");case"bun":throw new Error("Bun adapter not yet implemented");case"workerd":throw new Error("Cloudflare Workers does not support TCP servers (outbound only)");default:throw new Error(`Unsupported runtime: ${v}`)}}var te=(i=>(i[i.CRITICAL=0]="CRITICAL",i[i.HIGH=1]="HIGH",i[i.MEDIUM=2]="MEDIUM",i[i.LOW=3]="LOW",i))(te||{});var re=class{config;clients=new Set;constructor(e){this.config=e}async start(){await this.config.pooler.start(),await ee({hostname:this.config.hostname??"0.0.0.0",port:this.config.port,handler:{onConnection:e=>this.handleConnection(e),onError:e=>console.error("[Server] Error:",e)}}),console.log(`[Server] Listening on ${this.config.hostname??"0.0.0.0"}:${this.config.port}`)}async stop(){await this.config.pooler.stop(),console.log("[Server] Stopped")}async handleConnection(e){let t=await e.opened,r=`${t.remoteAddress.hostname}:${t.remoteAddress.port}`;this.clients.add(r),console.log(`[Server] Client connected: ${r}`);try{await this.processQueries(e,r)}catch(i){console.error(`[Server] Error handling client ${r}:`,i)}finally{this.clients.delete(r),console.log(`[Server] Client disconnected: ${r}`)}}async processQueries(e,t){let r=e.readable.getReader(),i=e.writable.getWriter(),s=new TextDecoder,a=new TextEncoder,c="";try{for(;;){let{done:d,value:w}=await r.read();if(d)break;c+=s.decode(w,{stream:!0});let y=c.split(`
`);c=y.pop()??"";for(let h of y){let m=h.trim();m&&await this.handleQuery(i,a,t,m)}}}finally{r.releaseLock(),i.releaseLock()}}async handleQuery(e,t,r,i){try{let s=await this.config.pooler.query(i,[],2),a=JSON.stringify({status:"success",rows:s.rows,rowCount:s.rows.length,fields:s.fields});await e.write(t.encode(a+`
`))}catch(s){let a=JSON.stringify({status:"error",message:s instanceof Error?s.message:String(s)});await e.write(t.encode(a+`
`))}}getClients(){return Array.from(this.clients)}};export{X as PGlitePooler,re as PGliteServer,q as PostgrestParser,j as PriorityQueue,te as QueryPriority,v as RUNTIME,N as SupabaseClient,De as connect,Be as createSupabaseClient,Y as detectRuntime,pe as isBun,fe as isDeno,de as isNode,ge as isWorkerd,ee as listen};
//# sourceMappingURL=index.js.map
